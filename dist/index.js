!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("cui-light",[],e):"object"==typeof exports?exports["cui-light"]=e():t["cui-light"]=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e),n.d(e,"BPD_Flow_ver",(function(){return w})),n.d(e,"counter",(function(){return m})),n.d(e,"Flow",(function(){return x})),n.d(e,"FlowActionManager",(function(){return k})),n.d(e,"FlowDict",(function(){return T}));var i=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function o(t){try{h(i.next(t))}catch(t){r(t)}}function u(t){try{h(i.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}h((i=i.apply(t,e||[])).next())}))};class s{constructor(t){this.action=t}invoke(t,e){return i(this,void 0,void 0,(function*(){let n=this.action.perform(t).then(t=>{this.all(e,e=>{e.update(t)})}).catch(t=>{this.all(e,e=>{e.update(null,t)})});return yield n,!0}))}all(t,e){t.forEach((t,n)=>{e(t,n)})}}var r,o,u=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},h=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class a{constructor(t){r.set(this,void 0),o.set(this,void 0),u(this,o,null),u(this,r,null),this.id="FlowTask-"+t}update(t,e){e&&h(this,o)?h(this,o).call(this,e):t&&h(this,r)&&h(this,r).call(this,t)}finish(t){return u(this,r,t),this}error(t){return u(this,o,t),this}}r=new WeakMap,o=new WeakMap;var l,c,f,d,p,v,y=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},b=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};const w="0.1.0",g=m();function*m(){let t=0;for(;;){((yield t++)||t>2e5)&&(t=0)}}class x{constructor(...t){this.actions={},t.forEach(t=>{this.actions[t.name]=new k(t)})}subscribe(t,e){let n=this.actions[t];return n?n.subscribe(e):null}unsubscribe(t,e){let n=this.actions[t];n&&n.unsubscribe(e)}perform(t,e){let n=this.actions[t];n&&n.perform(e)}}class k{constructor(t){l.set(this,void 0),c.set(this,void 0),f.set(this,void 0),d.set(this,void 0),p.set(this,void 0),y(this,l,[]),y(this,c,t),y(this,d,new s(t)),y(this,p,new T)}subscribe(t){let e=null;if(t){if(this.findTaskIndex(t.id)>-1)return t;e=t}else e=new a(g.next+"");return b(this,l).push(e),e}unsubscribe(t){let e=this.findTaskIndex(t);e>-1&&b(this,l).splice(e,1)}perform(t,e){let n=null!=e?e:this.getKey(t);b(this,p).add(n,t),this.call()}getStats(){return{queueCount:b(this,p).count(),subscribersCount:b(this,l).length}}findTaskIndex(t){return b(this,l).findIndex(e=>e.id===t)}call(){if(!b(this,f)){y(this,f,!0);let t=b(this,p).first();b(this,d).invoke(t,b(this,l)).then(t=>{y(this,f,!1),b(this,p).removeIndex(0),b(this,p).count()>0&&this.call()})}}getKey(t){return"string"==typeof t?t:"boolean"==typeof t||"number"==typeof t?t+"":Array.isArray(t)?`[${0===t.length?0:t.length}]`:JSON.stringify(t)}}l=new WeakMap,c=new WeakMap,f=new WeakMap,d=new WeakMap,p=new WeakMap;class T{constructor(t){v.set(this,void 0),this.keys=[],this.values=[],y(this,v,t)}add(t,e){if(!this.has(t))return this.keys.push(t),this.values.push(e),void this.publish("add","STATE","Key: "+t+" added");this.publish("add","FAIL","Key: "+t+" exists")}has(t){return this.indexOf(t)>-1}remove(t){let e=this.indexOf(t);if(e>-1)return this.removeIndex(e),void this.publish("add","STATE","Key: "+t+" removed");this.publish("add","STATE","Key: "+t+" not found")}get(t){let e=this.indexOf(t);return e>-1?this.values[e]:(this.publish("add","STATE","Key: "+t+" not found"),null)}count(){return this.keys.length}clear(){this.keys=[],this.values=[],this.publish("clear","STATE","Finished")}shift(){return this.keys.shift(),this.values.shift()}first(){return this.count()>0?this.values[0]:null}removeIndex(t){t>-1&&this.values.length>t&&(this.keys.splice(t,1),this.values.splice(t,1))}indexOf(t){return t?this.keys.indexOf(t):-1}publish(t,e,n){b(this,v)&&b(this,v).call(this,t,e,n)}}v=new WeakMap}])}));
//# sourceMappingURL=index.js.map