!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("cui-light",[],e):"object"==typeof exports?exports["cui-light"]=e():t["cui-light"]=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e),n.d(e,"BPD_Flow_ver",(function(){return M})),n.d(e,"counter",(function(){return E})),n.d(e,"FlowFactory",(function(){return S})),n.d(e,"Flow",(function(){return j})),n.d(e,"FlowActionManager",(function(){return W})),n.d(e,"FlowDict",(function(){return A}));var i=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{h(i.next(t))}catch(t){s(t)}}function u(t){try{h(i.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}h((i=i.apply(t,e||[])).next())}))};class r{constructor(t){this.action=t}invoke(t,e){return i(this,void 0,void 0,(function*(){let n=this.action.perform(t).then(t=>{this.all(e,e=>{e.update(t)})}).catch(t=>{this.all(e,e=>{e.update(null,t)})});return yield n,!0}))}all(t,e){t.forEach((t,n)=>{e(t,n)})}}var s,o,u=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},h=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class a{constructor(t){s.set(this,void 0),o.set(this,void 0),u(this,o,null),u(this,s,null),this.id="FlowTask-"+t}update(t,e){e&&h(this,o)?h(this,o).call(this,e):t&&h(this,s)&&h(this,s).call(this,t)}finish(t){return u(this,s,t),this}error(t){return u(this,o,t),this}}s=new WeakMap,o=new WeakMap;var c,l,f=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{h(i.next(t))}catch(t){s(t)}}function u(t){try{h(i.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}h((i=i.apply(t,e||[])).next())}))},d=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},p=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class v{constructor(t,e,n){c.set(this,void 0),l.set(this,void 0),this.name=t,d(this,c,e),d(this,l,n)}perform(t){return f(this,void 0,void 0,(function*(){if(p(this,c))return p(this,l)?p(this,c).apply(p(this,l),t):p(this,c).call(this,t)}))}}c=new WeakMap,l=new WeakMap;var y,w,b,m,g,x,k=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},T=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};const M="0.1.0",O=E();function*E(){let t=0;for(;;){((yield t++)||t>2e5)&&(t=0)}}class S{static create(t){let e=function(t){let e=[];for(let n in t)t.hasOwnProperty(n)&&"function"==typeof t[n]&&e.push(new v(n,t[n]));return e}(t);return new j(...e)}static fromList(...t){return new j(...t)}}class j{constructor(...t){this.actions={},t.forEach(t=>{this.actions[t.name]=new W(t)})}subscribe(t,e){let n=this.actions[t];if(!n)return null;if(!e)return n.subscribe();let i=n.subscribe(e.task);return e.finish&&i.finish(e.finish),e.error&&i.error(e.error),i}unsubscribe(t,e){let n=this.actions[t];n&&n.unsubscribe(e)}perform(t,e){let n=this.actions[t];n&&n.perform(e)}}class W{constructor(t){y.set(this,void 0),w.set(this,void 0),b.set(this,void 0),m.set(this,void 0),g.set(this,void 0),k(this,y,[]),k(this,w,t),k(this,m,new r(t)),k(this,g,new A)}subscribe(t){let e=null;if(t){if(this.findTaskIndex(t.id)>-1)return t;e=t}else e=new a(O.next().value+"");return T(this,y).push(e),e}unsubscribe(t){let e=this.findTaskIndex(t);e>-1&&T(this,y).splice(e,1)}perform(t,e){let n=null!=e?e:this.getKey(t);T(this,g).add(n,t),this.call()}getStats(){return{queueCount:T(this,g).count(),subscribersCount:T(this,y).length}}findTaskIndex(t){let e="";return e="string"==typeof t?t:t.id,T(this,y).findIndex(t=>t.id===e)}call(){if(!T(this,b)){k(this,b,!0);let t=T(this,g).first();T(this,m).invoke(t,T(this,y)).then(t=>{k(this,b,!1),T(this,g).removeIndex(0),T(this,g).count()>0&&this.call()})}}getKey(t){return"string"==typeof t?t:"boolean"==typeof t||"number"==typeof t?t+"":Array.isArray(t)?`[${0===t.length?0:t.length}]`:JSON.stringify(t)}}y=new WeakMap,w=new WeakMap,b=new WeakMap,m=new WeakMap,g=new WeakMap;class A{constructor(t){x.set(this,void 0),this.keys=[],this.values=[],k(this,x,t)}add(t,e){if(!this.has(t))return this.keys.push(t),this.values.push(e),void this.publish("add","STATE","Key: "+t+" added");this.publish("add","FAIL","Key: "+t+" exists")}has(t){return this.indexOf(t)>-1}remove(t){let e=this.indexOf(t);if(e>-1)return this.removeIndex(e),void this.publish("add","STATE","Key: "+t+" removed");this.publish("add","STATE","Key: "+t+" not found")}get(t){let e=this.indexOf(t);return e>-1?this.values[e]:(this.publish("add","STATE","Key: "+t+" not found"),null)}count(){return this.keys.length}clear(){this.keys=[],this.values=[],this.publish("clear","STATE","Finished")}shift(){return this.keys.shift(),this.values.shift()}first(){return this.count()>0?this.values[0]:null}removeIndex(t){t>-1&&this.values.length>t&&(this.keys.splice(t,1),this.values.splice(t,1))}indexOf(t){return t?this.keys.indexOf(t):-1}publish(t,e,n){T(this,x)&&T(this,x).call(this,t,e,n)}}x=new WeakMap}])}));
//# sourceMappingURL=index.js.map